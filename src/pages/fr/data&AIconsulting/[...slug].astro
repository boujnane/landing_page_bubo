---
import { changeLanguage } from "i18next";
import BlogPostLayout from "@/layouts/blog-post.astro";
import { getCollection, type CollectionEntry } from "astro:content";
import { useLocation } from "@/lib/location";

changeLanguage("fr");

const { lang } = useLocation(Astro.url.pathname);
export async function getStaticPaths() {
    const posts = await getCollection("blog");
    return posts.map((post) => ({
        params: { slug: post.slug },
        props: post,
    }));
}
type Props = CollectionEntry<"blog">;
const post = Astro.props;
const slug = Astro.params.slug;
const { pathname } = Astro.url;
const getPathSlug = (url: string) => url.includes("-fr") ? url : url + "-fr";
const newSlug = lang === "fr" ? pathname.replace("-fr", "") : getPathSlug(pathname);
Astro.rewrite(newSlug);
const { Content } = await post.render();
if (!slug || !post) {
    return new Response(null, {
        status: 404,
        statusText: "Not found"
    });
}
---
<BlogPostLayout {...post}>
	<Content />
</BlogPostLayout>
